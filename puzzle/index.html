<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Puzzle â€“ Patrimoine Culturel Dogon</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  text-align:center;
  background:#f4f4f4;
}

/* INTRO */
#intro{
  min-height:100vh;
  background:linear-gradient(#fffbe6,#e6f5ec);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  padding:20px;
}
.intro-logos{display:flex;gap:35px;margin-bottom:25px}
.intro-logos img{height:100px}
.intro-section{
  background:#fff;
  padding:18px;
  margin:12px;
  border-radius:14px;
  max-width:560px;
  box-shadow:0 6px 12px rgba(0,0,0,.12)
}
#intro button{
  margin-top:20px;
  padding:14px 30px;
  font-size:18px;
  background:#2c7a4b;
  color:#fff;
  border:none;
  border-radius:10px;
  cursor:pointer
}
.intro-footer{margin-top:25px;font-style:italic;color:#555}

/* MENU */
#menu{display:none;padding:20px}
#theme-selection{
  display:flex;
  justify-content:center;
  gap:18px;
  flex-wrap:wrap;
  margin:20px 0
}
.thumbnail{
  width:110px;height:110px;
  border-radius:12px;
  cursor:pointer;
  border:3px solid #333;
  transition:.25s
}
.thumbnail:hover{transform:scale(1.1)}
.thumbnail.selected{
  border-color:gold;
  box-shadow:0 0 18px gold
}
button{
  margin:10px;
  padding:12px 20px;
  border-radius:8px;
  border:none;
  background:#2c7a4b;
  color:#fff;
  cursor:pointer
}

/* JEU */
#game{display:none;padding:20px}
#puzzle{
  margin:20px auto;
  display:grid;
  border:3px solid #333
}
.piece{border:1px solid #ccc;cursor:grab}

/* INFO */
#info-box{
  display:none;
  position:fixed;
  top:50%;left:50%;
  transform:translate(-50%,-50%);
  background:#fffbe6;
  border:3px solid gold;
  padding:25px;
  border-radius:14px;
  max-width:460px;
  box-shadow:0 0 25px rgba(0,0,0,.35);
  z-index:999
}

/* STATS */
#stats{
  margin-top:15px;
  font-size:14px;
  opacity:.8
}
</style>
</head>

<body>

<!-- INTRO -->
<div id="intro">
  <div class="intro-logos">
    <img src="images/logo-service.png">
    <img src="images/logo-festival.png">
  </div>

  <h1>ðŸ§© Puzzle Patrimoine Culturel Dogon</h1>

  <div class="intro-section">
    <h3>Pourquoi ce jeu ?</h3>
    <p>DÃ©couvrir le patrimoine Dogon par le jeu.</p>
  </div>

  <div class="intro-section">
    <h3>Ce que tu vas apprendre</h3>
    <ul style="text-align:left">
      <li>âœ” Culture Dogon</li>
      <li>âœ” Observation</li>
      <li>âœ” Patience</li>
    </ul>
  </div>

  <button onclick="startIntro()">ðŸŽ® Commencer</button>
  <p class="intro-footer">Jeu Ã©ducatif â€“ Hors ligne</p>
</div>

<!-- MENU -->
<div id="menu">
  <h2>Choisis un thÃ¨me</h2>

  <div id="theme-selection">
    <img src="images/image1.jpg" class="thumbnail" onclick="setImage(this)">
    <img src="images/image2.jpg" class="thumbnail" onclick="setImage(this)">
    <img src="images/image3.jpg" class="thumbnail" onclick="setImage(this)">
    <img src="images/image4.jpg" class="thumbnail" onclick="setImage(this)">
  </div>

  <h3>Niveau</h3>
  <button onclick="launchGame(3)">Facile (9 piÃ¨ces)</button>
  <button onclick="launchGame(4)">Difficile (16 piÃ¨ces)</button>

  <div id="stats"></div>
</div>

<!-- JEU -->
<div id="game">
  <button onclick="backToMenu()">â¬… Retour</button>
  <div id="puzzle"></div>
</div>

<!-- INFO -->
<div id="info-box">
  <p id="info-text"></p>
  <button onclick="closeInfo()">OK</button>
</div>

<script>
/* ===== STATS ===== */
function initStats(){
  if(!localStorage.getItem("puzzleStats")){
    localStorage.setItem("puzzleStats",JSON.stringify({
      sessions:0,
      games:0,
      wins:0
    }));
  }
}
function updateStats(key){
  const s=JSON.parse(localStorage.getItem("puzzleStats"));
  s[key]++;
  localStorage.setItem("puzzleStats",JSON.stringify(s));
}
function showStats(){
  const s=JSON.parse(localStorage.getItem("puzzleStats"));
  document.getElementById("stats").innerHTML=
    `ðŸ“Š Sessions : ${s.sessions} | Parties : ${s.games} | RÃ©ussites : ${s.wins}`;
}

/* ===== INIT ===== */
initStats();
updateStats("sessions");

const puzzle=document.getElementById("puzzle");
const menu=document.getElementById("menu");
const game=document.getElementById("game");
const infoBox=document.getElementById("info-box");
const infoText=document.getElementById("info-text");

let size=3, draggedPiece=null, currentImage="";
const winSound=new Audio("audio/bravo.mp3");

const themeTexts={
  "image1.jpg":"Les falaises Dogon sont un chef-dâ€™Å“uvre architectural.",
  "image2.jpg":"Les masques Dogon ont une fonction rituelle.",
  "image3.jpg":"Le tourisme Dogon valorise culture et paysages.",
  "image4.jpg":"La culture Dogon est transmise oralement."
};

function startIntro(){
  document.getElementById("intro").style.display="none";
  menu.style.display="block";
  showStats();
}

function setImage(img){
  currentImage=img.src;
  document.querySelectorAll(".thumbnail").forEach(t=>t.classList.remove("selected"));
  img.classList.add("selected");
}

function launchGame(n){
  if(!currentImage){alert("Choisis un thÃ¨me");return;}
  size=n;
  updateStats("games");
  menu.style.display="none";
  game.style.display="block";
  puzzle.innerHTML="";
  createPuzzle();
}

function backToMenu(){
  game.style.display="none";
  menu.style.display="block";
  puzzle.innerHTML="";
  currentImage="";
  document.querySelectorAll(".thumbnail").forEach(t=>t.classList.remove("selected"));
  showStats();
}

function createPuzzle(){
  const pieceSize=300/size;
  puzzle.style.width="300px";
  puzzle.style.height="300px";
  puzzle.style.gridTemplateColumns=`repeat(${size},1fr)`;

  let pos=[...Array(size*size).keys()].sort(()=>Math.random()-0.5);

  pos.forEach(p=>{
    const d=document.createElement("div");
    d.className="piece";
    d.draggable=true;
    d.style.width=pieceSize+"px";
    d.style.height=pieceSize+"px";
    d.dataset.correct=p;

    const x=(p%size)*pieceSize;
    const y=Math.floor(p/size)*pieceSize;
    d.style.backgroundImage=`url('${currentImage}')`;
    d.style.backgroundSize="300px 300px";
    d.style.backgroundPosition=`-${x}px -${y}px`;

    d.addEventListener("dragstart",()=>draggedPiece=d);
    d.addEventListener("dragover",e=>e.preventDefault());
    d.addEventListener("drop",()=>{
      swapPieces(draggedPiece,d);
      checkVictory();
    });
    puzzle.appendChild(d);
  });
}

function swapPieces(a,b){
  [a.style.backgroundPosition,b.style.backgroundPosition]=
  [b.style.backgroundPosition,a.style.backgroundPosition];
  [a.dataset.correct,b.dataset.correct]=
  [b.dataset.correct,a.dataset.correct];
}

function checkVictory(){
  const ok=[...document.querySelectorAll(".piece")]
    .every((p,i)=>parseInt(p.dataset.correct)===i);

  if(ok){
    winSound.currentTime=0;
    winSound.play();
    updateStats("wins");
    const key=currentImage.split("/").pop();
    infoText.textContent=themeTexts[key];
    infoBox.style.display="block";
  }
}

function closeInfo(){infoBox.style.display="none";}
</script>

</body>
</html>
